rohac={model:{},view:{},controller:{reg:{"=":/\s*=\s*/,"|":/\s*\|\s*/,"()":/\((.*)\)/g,"{{}}":/\{\{([^}]*)\}\}/g,"{{=}}":/\{\{(\w+\s*=\s*.*)\}\}/g},$:function(e){return document.querySelectorAll(e)}},init:function(){for(var e=this.view.targets,r=e.length,t=0;r>t;t++)e[t]=this.getDom(document.querySelector('[rh-scope="'+t+'"]'),e[t]);this.readyCallback&&this.readyCallback()},getDom:function(e,r){var t=[];if("string"==typeof r)return[{node:e,template:r}];for(var n in r)t=t.concat(this.getDom(e.childNodes[n],r[n]));return t},ready:function(e){this.readyCallback=e},create:function(){},read:function(){},update:function(){},remove:function(){}},rohac.model.scopes=[{_id:0,_parentId:null,_childrenIds:null,_type:"scope",a:0,b:"a string",c:[1,2,3,4,5],d:{num:0,str:"a string",arr:[1,2,3,4,{obj:"an object"}]},init:void 0},{_id:1,_parentId:null,_childrenIds:[2],_type:"scope",init:void 0},{_id:2,_parentId:1,_childrenIds:[3,4],_type:"scope",a:0,init:void 0},{_id:3,_parentId:2,_childrenIds:null,_type:"scope",a:1,init:void 0},{_id:4,_parentId:2,_childrenIds:null,_type:"scope",init:void 0},{_id:5,_parentId:null,_childrenIds:null,_type:"scope",a:1,b:2,c:3,d:4,init:void 0},{_id:6,_parentId:null,_childrenIds:[7],_type:"scope",a:{person:[{name:"John"},{name:"James"},{name:"Jack"}],contry:["U.S.A.","Germany","Canada"]},init:void 0},{_id:7,_parentId:6,_type:"repeat",init:void 0}],rohac.model.rootScopeIds=[0,1,5,6],rohac.model.findProperty=function(e,r){var t=this.scopes[r];return"undefined"!=typeof t[e]?t[e]:null!==t._parentId?this.findProperty(e,t._parentId):"undefined"!=typeof this[e]?this[e]:""},rohac.view.targets=[{1:{},3:{1:{0:"a = {{a}}"},3:{0:"b = {{b}}"},5:{0:"c = {{c}}"},7:{0:"c[0] = {{c[0]}}"},9:{0:"d = {{d}}"},11:{0:"d.num = {{d.num}}"},13:{0:"d.str = {{d.str}}"},15:{0:"d.arr = {{d.arr}}"},17:{0:"d.arr[4].obj = {{d.arr[4].obj}}"},19:{0:"c[0] + d.arr[3] = {{c[0] + d.arr[3]}}"},21:{0:"e = {{e}}"}}},{1:{},2:"     a = {{a}}     ",4:"     a = {{a}}		   "},{0:"              a = {{a}}       ",2:"       a = {{a}}       "},{0:"                  a = {{a}}       "},{0:"         a = {{a}}       "},{1:{},2:"                         - 4 / (1 - (6 / -2)) = {{- 4 / (1 - (6 / -2))}} ",3:{},4:"     d + c / (d - c) * b - 10 + a = {{d + c / (d - c) * b - 10 + a}}   "},{1:{}},{}],rohac.view.repeaters=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,"       <li>a.person.name = {{a.person[?].name}}, a.contry = {{a.contry[?]}}</li>     "],rohac.controller.compile=function(e,r,t,n){for(var i=r.targets[e],o=t.scopes[e],a=i.length,s=0;a>s;s++)i[s].node.nodeValue=this.parse(i[s].template,e,t);if("repeat"===o._type&&(this.$('[rh-scope="'+e+'"]')[0].innerHTML=this.repeat(r.repeaters[e],e,t)),"loopChildren"===n&&Array.isArray(o._childrenIds)&&0!==o._childrenIds.length)for(var c=o._childrenIds.length,s=0;c>s;s++)this.compile(o._childrenIds[s],r,t,"loopChildren")},rohac.controller.parse=function(e,r,t){var n,i=this;return e.replace(this.reg["{{}}"],function(e,o){if(i.reg["|"].test(o)){n=o.split(i.reg["|"])[0];var a=i.modifiers[o.split(i.reg["|"])[1]]}else n=o;return/[\+\-\*\/\(\)%]/.test(n)?(n=n.replace(/[^\+\-\*\/\(\)%\s]+/g,function(e){return isNaN(e)?i.parseLiteral(e,r,t,a):e}),i.parser.openEqu(n)):i.parseLiteral(n,r,t,a)})},rohac.controller.parseLiteral=function(e,r,t,n){var i=e.search(/[\.\[]/);return-1===i?value=t.findProperty(e,r):(value=t.findProperty(e.slice(0,i),r),value=this.parser.openObj(e,value)),"undefined"!=typeof n&&(value=n(value)),"number"==typeof value||"string"==typeof value?value:JSON.stringify(value)},rohac.controller.repeat=function(e,r,t){var n,i,o,a=this,s="",c={},l=0;e.replace(this.reg["{{}}"],function(e,i){o=i.search(/[\.\[]/),n=t.findProperty(i.slice(0,o),r),o=i.slice(0,i.indexOf("[?]")).search(/[\.\[]/),-1!==o&&(n=a.parser.openObj(i.slice(0,i.indexOf("[?]")),n)),c[i]=n});for(var d in c)Array.isArray(c[d])&&c[d].length>l&&(l=c[d].length);for(var p=0;l>p;p++)s+=e.replace(this.reg["{{}}"],function(e,r){if(a.reg["|"].test(r)){i=r.split(a.reg["|"])[0];var t=a.modifiers[r.split(a.reg["|"])[1]]}else i=r;return i=i.slice(i.indexOf("[?]")).replace("[?]","["+p+"]"),n=a.parser.openObj(i,c[r]),"undefined"!=typeof t&&(n=t(n)),"number"==typeof n||"string"==typeof n?n:JSON.stringify(n)});return s},rohac.controller.parser={operators:{"+xor-":function(e){return e.replace(/[+-]\s*[+-]/,function(e){return e.slice(0,1)===e.slice(e.length-1)?"+":"-"})},"()":function(e){e=this["+xor-"](e);for(var r=0,t=e.split(/\s(?=[+-])/),n=t.length,i=0;n>i;i++)/[\*\/]\s*$/.test(t[i])&&/^\s*\-/.test(t[i+1])&&(t[i]=this["+xor-"]("-"+t[i]+t[i+1].slice(t[i+1].indexOf("-")+1)),t.splice(i+1,1),n=t.length),r+=this["+-"](t[i]);return r},"+-":function(e){return"+"===e.charAt(0)?this["*/%"](e.slice(1)):"-"===e.charAt(0)?-this["*/%"](e.slice(1)):this["*/%"](e)},"*/%":function(e){var r,t,n=e.search(/[\*\/%](?!.*[\*\/%])/);return-1===n?parseInt(e):(r=e.slice(n+1),t=e.slice(n,n+1),e=e.slice(0,n),"*"===t?this["*/%"](e)*parseInt(r):"/"===t?this["*/%"](e)/parseInt(r):"%"===t?this["*/%"](e)%parseInt(r):void 0)}},openObjExpr:function(e,r){var t,n,i=e.search(/\]/),o=e.search(/[\.\[]/);return-1===o?-1===i?r[e]:r[parseInt(e.slice(0,i))]:(i>o||-1===i?(t=e.slice(0,o),n=e.slice(o+1)):o>i&&(t=parseInt(e.slice(0,i)),n=e.slice(i+2)),this.openObjExpr(n,r[t]))},openObj:function(e,r){return this.openObjExpr(e.slice(e.search(/[\.\[]/)+1),r)},openEqu:function(e){for(var r,t=e.length,n=[],i=0;t>i;i++)"("===e.charAt(i)?n.push(i):")"===e.charAt(i)&&(r=n.pop(),e=e.slice(0,r)+this.operators["()"](e.slice(r+1,i))+e.slice(i+1),t=e.length,i=r);return this.operators["()"](e)}},document.addEventListener("DOMContentLoaded",function(){console.log("DOM is ready!"),rohac.init()}),window.onload=function(){console.log("window is loaded!")};